!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).GameCapsule=e()}(this,function(){"use strict";var e="GameCapsule",n=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),s=0<navigator.userAgent.indexOf("Android"),o=n||s,a=(t.prototype.draw=function(){var t=Math.random()*this.totalWeight,e=0;for(var i in this.list){var n=this.list[i];if(t<(e+=n[this.key]))return n}},t);function t(t,e){var i;this.list=t,this.key=e,this.totalWeight=(i=0,t.forEach(function(t){return i+=t[e]}),i)}function i(e){var t,i=this;this.options={target:"#canvas",isRetina:!0,isTouch:!0,parent:null,countDownSeconds:0},e&&Object.keys(e).forEach(function(t){i.options[t]=e[t]}),this.isIos=n,this.isAndroid=s,this.isMobile=o,this.Gacha=a,this.isPause=!1,this._initTimer(),this._initStage(),window.addEventListener("resize",function(){t&&clearTimeout(t),t=setTimeout(function(){i._resizeHandle()},200)})}return i.prototype.init=function(){throw new Error(e+"コンストラクタで作ったインスタンスにinit関数を定義し、stageの更新で使う変数、関数を定義してください。\n※ init関数ではthis.stageでstageにアクセスできます。\n※ init関数では変数をthisに定義すればupdate関数で利用することができます。\n※ update関数で何もつかわない場合でも中身は空っぽで良いのでinit関数を定義してください。")},i.prototype.update=function(t){throw new Error(e+'コンストラクタで作ったインスタンスにupdate関数を定義し、メインループ処理を設定してください。\n※ updade関数ではthis.stageでstageにアクセスできます。\n※ updade関数ではinit関数で定義した変数をthis経由で使用できます。\n※ stage.update()はupdade関数の直後に自動で実行されるのでupdate関数内でstege.update()を実行する必要はありません。\n※ \bupdate関数の引数には"tick"イベントが入ってきます')},i.prototype.play=function(){var e=this;createjs.Ticker.init(),createjs.Ticker.timingMode=createjs.Ticker.RAF;try{this.init()}catch(t){return console.error(t),!1}createjs.Ticker.addEventListener("tick",createjs.Tween),createjs.Ticker.addEventListener("tick",function(t){if(e.isPause)return!1;try{e.update(t)}catch(t){e._clearStage(),console.error(t)}e.stage.update()}),this.timer=setInterval(function(){e.totalTime.s++,e.totalTime.m=Math.floor(e.totalTime.s/60)},1e3),this.stage.update()},i.prototype.pause=function(){createjs.Ticker.paused=!createjs.Ticker.paused,this.isPause=!this.isPause},i.prototype.reset=function(){this._clearStage(),this._initTimer(),this._initStage(),this.play()},Object.defineProperty(i.prototype,"mouseX",{get:function(){return this.divisionRetina(this.stage.mouseX)},set:function(t){this.options.isRetina&&window.devicePixelRatio?this.stage.mouseX=t*window.devicePixelRatio:this.stage.mouseX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mouseY",{get:function(){return this.divisionRetina(this.stage.mouseY)},set:function(t){this.options.isRetina&&window.devicePixelRatio?this.stage.mouseY=t*window.devicePixelRatio:this.stage.mouseY=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.divisionRetina(this.stage.canvas.width)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.divisionRetina(this.stage.canvas.height)},enumerable:!0,configurable:!0}),i.prototype.getDispTime=function(t){var e={s:Math.floor(this.totalTime.s%60),m:this.totalTime.m};return t&&(e.s=this.zeroPadding(e.s,2),e.m=this.zeroPadding(e.m,2)),e},i.prototype.getRemainingTime=function(t){if(!this.options.countDownSeconds)return!1;var e=this.options.countDownSeconds-this.totalTime.s,i={s:e,m:Math.floor(e/60)};return t&&(i.s=this.zeroPadding(i.s,2),i.m=this.zeroPadding(i.m,2)),i},i.prototype.divisionRetina=function(t){return this.options.isRetina?t/window.devicePixelRatio:t},i.prototype.createRandom=function(t,e){return function(t,e){return Math.floor(Math.random()*(e-t)+t)}(t,e)},i.prototype.zeroPadding=function(t,e){return function(t,i){return(function(){for(var t="",e=0;e<i;e++)t+="0";return t}()+t.toString()).slice(-i)}(t,e)},i.prototype.isCountDownComplete=function(){if(!this.options.countDownSeconds)return!1;if(this.totalTime.s>this.options.countDownSeconds){var t=document.createEvent("HTMLEvents");return t.initEvent("countDownComplete",!0,!1),window.dispatchEvent(t),!0}return!1},i.prototype._clearStage=function(){this.isPause=createjs.Ticker.paused=!1,createjs.Ticker.removeEventListener("tick",this.stage),createjs.Ticker.reset(),this.stage.removeAllChildren(),createjs.Tween.removeAllTweens(),this.stage.clear()},i.prototype._initTimer=function(){clearTimeout(this.timer),this.totalTime={s:0,m:0}},i.prototype._initStage=function(){this.parent=this.options.parent?document.querySelector(this.options.parent):null,this.canvas=document.querySelector(this.options.target),this.canvas.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)"),this.canvas.style.setProperty("vertical-align","top"),this.stage=null,this.stage=new createjs.Stage(this.options.target.replace(/(.|#)/,"")),this._setCanvasSize(),this.options.isRetina&&this._devicePixelRatio(),this.options.isTouch&&createjs.Touch.isSupported()&&createjs.Touch.enable(this.stage)},i.prototype._setCanvasSize=function(){this.parent?(this.stage.canvas.width=this.canvas.width=this.parent.clientWidth,this.stage.canvas.height=this.canvas.height=this.parent.clientHeight):(this.stage.canvas.width=this.canvas.width=window.innerWidth,this.stage.canvas.height=this.canvas.height=window.innerHeight)},i.prototype._devicePixelRatio=function(){if(window.devicePixelRatio){var t=this.canvas.width,e=this.canvas.height;this.canvas.width=t*window.devicePixelRatio,this.canvas.height=e*window.devicePixelRatio,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.stage.scaleX=this.stage.scaleY=window.devicePixelRatio}},i.prototype._resizeHandle=function(){this._setCanvasSize(),this.options.isRetina&&this._devicePixelRatio()},i});
